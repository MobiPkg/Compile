name: libvips
type: meson
source:
  git:
    url: https://github.com/libvips/libvips.git
    ref: v8.16.0
license: LICENSE

deps:
  - glib
  - expat
  - zlib
  - libjpeg-turbo
  - libpng
  - libwebp

flags:
  # iOS 支持 posix_memalign，但 meson 交叉编译检测失败，需要手动定义
  c: -fPIC -O2 -DHAVE_POSIX_MEMALIGN=1
  cxx: -fPIC -O2 -DHAVE_POSIX_MEMALIGN=1
  cpp: ""
  # 链接 libwebpmux/libwebpdemux (WebP 动画支持), libsharpyuv (libwebp 的私有依赖) 和 zlib (libpng 的依赖)
  ld: -lwebpmux -lwebpdemux -lsharpyuv -lz

options:
  # 禁用不需要的功能以减少依赖
  - -Dgtk_doc=false
  - -Dintrospection=disabled
  - -Dvapi=false
  - -Dmodules=disabled
  - -Dexamples=false
  - -Dcplusplus=false
  
  # 常用图像格式
  - -Djpeg=enabled
  - -Dpng=enabled
  - -Dwebp=enabled
  
  # 其他图像格式
  - -Dcgif=disabled
  - -Dnsgif=false
  - -Dtiff=disabled
  - -Dheif=disabled
  - -Djpeg-xl=disabled
  - -Dopenjpeg=disabled
  - -Dopenexr=disabled
  - -Dcfitsio=disabled
  - -Dnifti=disabled
  - -Dmatio=disabled
  - -Dopenslide=disabled
  
  # 功能模块
  - -Dexif=disabled
  - -Dlcms=disabled
  - -Dfftw=disabled
  - -Dorc=disabled
  - -Dhighway=disabled
  - -Dimagequant=disabled
  - -Dquantizr=disabled
  - -Darchive=disabled
  
  # 文本/矢量（iOS 不推荐）
  - -Dfontconfig=disabled
  - -Dpangocairo=disabled
  - -Drsvg=disabled
  - -Dpoppler=disabled
  - -Dpdfium=disabled
  - -Dmagick=disabled
  
  # 始终禁用
  - -Dspng=disabled
  # zlib 被 libpng 需要，启用它
  - -Dzlib=enabled
