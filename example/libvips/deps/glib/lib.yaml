name: glib
type: meson
source:
  git:
    url: https://github.com/GNOME/glib.git
    ref: 2.82.4
license: COPYING

deps:
  - libffi
  - pcre2
  - zlib

# Android 平台配置
# API 28+ 内置 iconv，API 31+ 修复了 frexpl 问题
android:
  min_sdk: 28
  # Android 不需要 pcre2 fallback，因为我们单独构建了 pcre2
  options:
    - --force-fallback-for=proxy-libintl,gvdb

# iOS 平台配置
ios:
  # iOS 需要 pcre2 fallback（使用 glib 内置的 pcre2 subproject）
  options:
    - --force-fallback-for=proxy-libintl,gvdb,pcre2

# glib 会产生多个库文件
extra_libs:
  - libgio-2.0
  - libgobject-2.0
  - libgmodule-2.0
  - libgthread-2.0
  - libpcre2-8
  - libintl

flags:
  c: -fPIC -O2
  cxx: -fPIC -O2
  cpp: ""
  ld: ""

# 通用 options (不包含平台特定的 --force-fallback-for)
options:
  - -Dtests=false
  - -Dglib_debug=disabled
  - -Dintrospection=disabled
  - -Dnls=disabled
  - -Dlibmount=disabled
  - -Dselinux=disabled
  - -Dxattr=false
  - -Dlibelf=disabled
  - -Dglib_assert=false
  - -Dglib_checks=false
  # 注意：--force-fallback-for 选项已移到各平台特定配置中
  # proxy-libintl, gvdb 是 glib 内置的 subprojects
  # pcre2 fallback 仅用于 iOS（Android 单独构建 pcre2）
